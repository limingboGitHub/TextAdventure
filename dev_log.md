# 开发日志

## 2024年11月21日 星期四
* 1.【登录场景】登录界面的设计
* 2. 打包秘钥，名称:textmaplestory 密码:textmaplestory
D:\AndroidSDK/build-tools/28.0.3/apksigner.bat sign --verbose --ks <REDACTED> --ks-pass pass:<REDACTED> --ks-key-alias <REDACTED> ../../out/TextMapleStory.apk


## 2024年11月22日 星期五
* 1. 打通客户端的登录接口
_request_completed code:200 result:0
{ "code": "1" }
激动人心的一刻，登录成功！！！

## 2024年11月24日 星期日
* 1. 服务器和角色选择界面开发中

## 2024年11月27日 星期三
* 1. 角色的缓存工具基类
* 2. signal信号无法监听的问题，因为传递的参数有Array[DataPlayer]类型，只能使用Array类型
* 3. 本地文件持久化存储工具已完成，选取和创建角色已和存储工具联动

## 2024年11月28日 星期四
* 1. 只搭建大的世界框架，不写细节代码
* 2. 通过uml图初步设计游戏世界的基本类

## 2024年12月2日 星期一
* 1. 继续完善了游戏世界的基本类和UML类图
* 2. __敲定一个原则，初版只开发逻辑层的代码，不写任何UI代码__
* 3. 继续完善角色的基本类和UML类图，具象化每一个细节
  
## 2024年12月3日 星期二
* 1. 游戏世界的类设计已基本完成
* 2. 下一步开始交互设计，时序图

## 2024年12月5日 星期四
* 1. 完成攻击、拾取、装备交互的时序图设计
* 2. 下一步可以开始编码了
  
## 2024年12月6日 星期五
* 1. 完成了资源管理器的加载流程
* 2. 地图加载流程完毕，世界初始化完成

## 2024年12月9日 星期一
* 1. 完成地图的传送点加载
* 2. 展示地图基础信息

## 2024年12月12日 星期四
* 代办，人物属性和怪物属性的初始化，为攻击做准备

## 2024年12月17日 星期二
* 刷新点重构，每个刷新点刷新什么怪物应该是有概率的，这样可以限制某些怪物的刷新概率，
使得一些需要杀特定怪物的任务增加难度


## 2024年12月19日 星期四
* 物品id的管理，本质是要打通3块
* 1. 各种装备type对应的index（配置文件读取type）
* 2. 装备id对应的type（一套映射规则）
* 3. 装备id和type对应的中文名称和描述

* 消耗品分类
* 2000000 - 2004241 药水 √
* 2030000 - 2039999 回城卷轴 √
* 2040000 - 2049999 卷轴 √
* 2050000 - 2059999 异常药水 √
* 2060000 - 2069999	箭矢 √
* 2070000 - 2079999	飞镖 √
* 2080000 - 2089999 喇叭
* 2090000 - 2099999	全区特效
* 2100000 - 2109999 召唤包
* 2110000 - 2129999 宠物相关
* 2130000 - 2139999 告白
* 2140000 - 2149999 金币包子
* 2150000 - 2169999 请柬 贺卡
* 2170000 - 2179999 缩地
* 2180000 - 2189999 洗点
* 2190000 - 		测谎
* 2200000 - 		取名
* 2210000 - 		变身
* 2240000 - 		求婚戒指
* 2270000 - 		任务消耗品
* 2280000 - 2299999	技能册
* 2330000 - 		子弹
* 2340000 -			祝福卷轴
* 2350000 - 2360005 幽灵变身相关
* 2380000 -			怪物卡片
* 2390000 - 		任务道具
* 2610102 - 


# 2024年12月23日 星期一
代办：
* 1. 背包物品的使用
* 2. 装备栏

# 2024年12月24日
* 1. 拟合下攻击力的计算公式

| 攻击力 | 力量 | 敏捷 | 最终攻击力 |
| ------ | ---- | ---- | ---------- |
| 17     | 12   | 5    | 5          |
| 100    | 310  | 200  | 2000       |

final_attack = attack * (str * 1 + dex * 0.2) / 50
17 * (12 * 1 + 5 * 0.5) / 50 = 4.93
100 * (310 * 1 + 200 * 0.5) / 50 = 820

代办：
1. ~~怪物的攻击、人物受伤，死亡~~

# 2024年12月25日 星期三
下一步代办：
* 1. 完成彩虹村的所有场景，怪物布置，物品掉落
* 2. 开发NPC对话系统
* 3. 开发任务系统  

# 2025年1月1日 星期三
整理NPC功能类型：
* 1. ~~商店~~
* 2. 对话系统
* 3. 杀怪任务
* 4. 物品任务

# 2025年1月3日 星期五
# 梳理几个完整的任务流程

## 1.对话+杀怪任务
-> 点击NPC，发起第一段对话
-> 点击接受任务
-> 击杀对应数量怪物
-> 回到NPC处，发起第二段对话
-> 点击完成任务

# 2025年1月8日 星期三
# 任务功能梳理：
* 1. 主任务+二级子任务，展示进度
* 2. NPC有默认对话文本，但是随着任务进度改变，文本会变化
* 3. NPC的持有任务状态的生命周期：无任务->可接受任务->任务进行中->任务可完成->无任务
无任务：NPC没有设置任何任务；NPC有任务，但是玩家没有接受条件；NPC有任务，但是全部完成
任务可完成：NPC存在至少一个任务正在进行中，且任务所需条件已经满足
可接受任务：NPC存在至少一个任务未加入任务背包，且满足接受条件的任务，同时不存在可完成的任务
任务进行中：NPC存在至少一个任务进入任务背包，且任务未满足完成条件，同时不存在可完成和可接受的任务
* 4.每个任务完整的生命周期：未开始->进行中->已完成
* 5. 任务的进度：通过双向映射的形式，NPC只承载子任务，主任务的信息通过子任务查询

NPC对话流程梳理：
1. 点击NPC，NPC展示默认对话，并展示功能和任务列表
2. 点击任务A，播放任务A接受前的对话，展示接受按钮
3. 点击接受，任务A加入任务背包
4. 点击接受任务后的NPC，展示任务A进行中的对话
5. 点击任务的谈话目标NPC2，展示NPC2完成前的对话，展示完成按钮
6. 点击完成，任务A的对话目标完成
7. 再次点击NPC2，播放任务A的谈话目标NPC2完成后的对话


# 2025年2月5日
* 1. ~~继续任务功能，完成NPC对话交谈后，回去交付并最终完成任务~~
* 2. ~~代办：对话任务增加对话过程中的require和reward~~
* 3. ~~代办：任务要求和任务奖励的展示~~
* 4. 代办：击杀类任务实现
* 5. 代办：收集类任务实现

# 2025年2月6日
* 1. 代办：物品配置文件读取重构
* 2. 代办：每一件物品的构建
* 3. 再次想重构任务系统，该系统设计有些原子逻辑并未设计好，需要重新设计。

## 任务系统V3.0版本重构
要开始构思任务系统中的每个原子模块。
  
### 1. V1.0和V2.0想法
一个任务的构成元素：
1. 任务的名称
2. 任务的可见性要求、限制
3. 任务的完成条件
4. 任务的对话内容
5. 任务的完成奖励

一个任务的固定阶段：
1. before_accept
2. after_accept
3. after_accept_not_finish
4. after_accept_finish

任务最终的完成条件finish_condition：
1. talk
2. collect
3. kill

经过两轮开发，发现这样设计功能还不够合理，部分功能仍无法实现。例如，NPCA发布了一个任务，希望你找到NPCB谈话，NPCB要求你先击杀10只兔子，最终完成谈话，再回到NPCA交付任务。这类组合任务需求。

最终认为是没有将相似的功能逻辑统一为一个最小功能模块，例如finish_condition其实和require有类似的逻辑。且不应该设计为固定的4个阶段，太想当然了，应该设计的扩展性更高。

### 2. V3.0想法
一个任务的构成应该是由N个任务阶段组成，一个任务阶段则为一个原子的闭环流程，流程中可以包含对话、收集、击杀等操作。

一个任务的构成：
1. 名称
2. 可见性限制
3. 任务阶段列表

任务阶段（原子）：
1. 名称（可选）
2. 依附NPC
3. 完成要求（可选）
4. 对话
5. 完成奖励（可选）

完成要求中可以包含另一个任务阶段。

如此一个A->B->A的对话任务结构为
{
	"任务阶段列表":[
		{
			"名称":"任务阶段A",
			"对话":"去找B",
			"依附NPC":"NPCA",
			"完成奖励":[
				"物品":{
					"id":"信物A",
					"数量":1
				}
			]
		},
		{
			"名称":"任务阶段B",
			"对话":"收到，去回复A吧",
			"依附NPC":"NPCB",
			"完成要求":[
				"物品":{
					"id":"信物A",
					"数量":1
				},
				"击杀":{
					"id":"兔子",
					"数量":10
				}
			]
		},
		{
			"名称":"任务阶段C",
			"对话":"任务完成",
			"依附NPC":"NPCA",
			"完成奖励":[
				"经验":1000,
				"金钱":1000,
				"物品":{
					"id":"武器A",
					"数量":1
				}
			]
		}
	]
}


# 2025年2月9日
## 1. 任务系统V3.0，顺着任务的流程排查问题，当前问题，接受任务后，应该将任务阶段加入到NPC中，然后通过任务阶段来展示相关信息

# 2025年2月12日
## 1. 击杀类任务有问题
第一个页面：请帮除掉一些兔子。展示接受按钮
第二个页面：去吧。展示任务要求，杀10只兔子，展示完成按钮
第三个页面：辛苦了，这是你的报酬。展示任务完成奖励，展示完成按钮

## 2. 收集类任务

# 2025年2月13日
## 1. 游戏风格提示词：
游戏风格：剑与魔法共存，奇幻，卡通。

新手村落：

1.日落村
NPC分布：
老村长冈瑟（主线NPC）：拄着拐杖的退役骑士，发放剿灭魔物任务
铁匠布鲁托：满脸胡渣的武器商
裁缝玛莎：爱哼歌的防具商
艾琳：总是打瞌睡的少女，出售初级药水
哨兵罗伊（支线NPC）：焦虑的新手守卫，委托收集咕咕丘的野兔毛
酒馆老板卡尔：独眼，发布烹饪支线任务
老者阿隆：孤独的老人
车夫哈尔：传送到其他大陆


周边地区：

1.咕咕丘(咕咕小丘，咕咕大丘)
怪物分布：
* 咕咕小丘：白兔(lv 1)，灰兔(lv 2)
* 咕咕大丘：土拨鼠(lv 3)，鼹鼠(lv 4)
NPC分布：
2.萤火森林(萤火森林入口，萤火森林中部，萤火森林深处)
怪物分布：
* 萤火森林入口：瓢虫(lv 3)，萤火虫(lv 4)
* 萤火森林中部：狐狸(lv 5)，猴子(lv 6)
* 萤火森林深处：灰狼(lv 7)，黑狼(lv 8)
* 黑狼王的巢穴：黑狼王(lv 9)
NPC分布：
流浪法师阿尔文（隐藏NPC）：开启隐藏BOSS

初阶消耗品设计：
* 恢复药水：恢复生命值和魔法值
  1. 面包：恢复50点生命值
  2. 松饼：恢复100点生命值
  3. 烤鸡肉：恢复200点生命值
  4. 井水：恢复50点魔法值
  5. 橙汁：恢复100点魔法值
  6. 牛奶：恢复200点魔法值
* 炼金药剂：增加属性或特殊效果
  1. 狗尾草药剂：增加5点力量
  

怪物掉落杂物设计：
* 白兔：白兔毛
* 灰兔：灰兔毛
* 土拨鼠：鼠牙
* 鼹鼠：鼹鼠指甲
* 瓢虫：瓢虫壳
* 萤火虫：荧光粉
* 狐狸：狐狸皮
* 猴子：猴子毛
* 灰狼：灰狼尾巴
* 黑狼：黑狼爪子
* 黑狼王：黑狼王爪子

炼金材料设计：
* 狗尾草：狗尾草


这个一个新手区域的初步构图，我的设想：
1.玩家在该区域停留等级为1-10级
2.2个新手村和周边区域需要有基本的NPC类型，武器店，防具店，主线任务NPC，支线任务NPC，大约15个左右
3.周边区域的怪物分布在1-10级，需要设计1个10级左右的BOSS，作为新手村的守护者

请帮我完善新手村和周边区域的设计。




# 2025年2月18日
## 1. ~~地图需要增加一个迷雾机制，需要击杀10只怪物才可使用地图的传送点~~


# 2025年2月19日
## 1. 将新手村的NPC功能都设计好
## 2. ~~规划好一批0-10级的新手武器，防具，消耗品~~
## 3. 规划好新手村的支线任务
## 4. ~~商店的买卖功能好好设计一下~~

0-9级新手装备：
* 武器：
1. 木锤：lv 1 攻击力3-5
2. 伐木斧：lv 1 攻击力3-5
3. 长剑：lv 5 攻击力7-10
4. 村长的佩剑：lv 7 攻击力12

* 上衣：
1. 短衬衫：lv 1 防御力1-2
2. 黑衬衫：lv 5 防御力2-3

* 下衣：
1. 短裤：lv 1 防御力1-2
2. 牛仔裤：lv 5 防御力2-3

* 帽子：
1. 草帽：lv 3 防御力1-2

* 鞋子：
1. 布鞋：lv 1 防御力1-2
2. 马靴：lv 5 防御力2-3

新手村任务：
1. 任务名称：村长的历练。
   任务核心内容：接受村长的指示去找村口的哨兵接受一些历练，然后回复村长，完成成人礼的历练。
   * 任务阶段1：村长，名称：村长的指示：对话：“{player_name}，你已经成年，该去历练历练了，去找村口的哨兵罗伊吧！”；
   * 任务阶段2：哨兵罗伊，名称：哨兵罗伊；对话：“是村长派你来的吗？很精神，不错，一起加油吧！”；
   * 任务阶段3：哨兵罗伊，名称：兔子猎人；对话：“最近村口的兔子越来越多了，庄稼都被破坏了，我来守卫村子，你去他们的老巢咕咕小丘消灭一些兔子吧。”
   * 任务阶段4：哨兵罗伊，名称：逐渐成长；对话：“干的很好，我可以放心将艰巨的任务交给你了。去更危险的咕咕大丘消灭一些土拨鼠和鼹鼠吧。”
   * 任务阶段5：村长，名称：报告村长；对话：“不错，果然没有看错你，这是给你的成年礼。”
2. 任务名称：危险的森林
   任务核心内容：艾琳的哥哥不小心进入了森林深处，她希望你能够帮助她寻找哥哥的线索。深入萤火森林后最终找到了她的哥哥艾伦，将艾伦带回了村子。
   * 任务阶段1：艾琳，名称：忧伤的艾琳；对话：“哥哥~你怎么还没回来~~”
   * 任务阶段2：艾琳，名称：艾琳的担忧；对话：”两天前，我和哥哥在萤火森林外围采药，他让我先回来，可今天他还没有消息，我好担心他！勇敢的冒险家，能不能帮忙找找我的哥哥？”
   * 任务阶段3：艾伦，名称：森林深处；对话：“快跑，森林深处藏着一只狼王，我们不是他的对手！”
   * 任务阶段4：艾琳，名称：安然无恙；对话：“太好了，哥哥没事，感谢你，冒险家。”
3. 任务名称：炼金术士
   任务核心内容：原来艾伦是一个炼金术士，但是很初级。为了取得森林深处更稀有的月光草，你需要击败黑狼王，在它失去意识的时候拿回月光草。
   * 任务阶段1：艾伦，名称：炼金药剂；对话：“你知道‘炼金’技术吗？这是一种神奇的技术，能制造各种药剂强化自身或弱化怪物。请帮我收集一些黑狼爪子吧。”
   * 任务阶段2：艾伦，名称：黑狼王的巢穴；对话：“黑狼王就藏身在萤火森林最深处，去把他的爪子带来吧。”
4. 任务名称：久别的亲人
   任务核心内容：阿隆是一个独居老人，他的孙子小时候最喜欢帮他做萤火灯，但是孙子已经出去冒险了，他很想念他。冒险家帮他做了几盏萤火灯，老人十分感动。
   * 任务阶段1：阿隆，名称：昏暗的房间；对话：”萤火灯真的很美~我的孙子小时候最喜欢给我做这个了~”
   * 任务阶段2：阿隆，名称：萤火灯；对话：”在萤火森林的入口处就有很多萤火虫，千万别走太远了，小心！孩子。”
5. 任务名称：更精彩的冒险
   * 任务阶段1：车夫，名称：远方；对话：“在落日村之外还有更广阔、更精彩的世界，准备好了再来找我吧。”
代办BUG：
~~装备穿戴后，旧装备未正常脱下~~

# 2025年2月20日
## 1. ~~传送点和NPC的图重构，增加沉浸感（以后再说）~~

# 2025年2月21日
## 1. 任务的流程还是需要优化 

当前遇到的问题是，一个主任务下的多个任务阶段会自动开始，这导致部分逻辑衔接有问题。
例如：1. 对话村长，去找哨兵；2. 对话哨兵，准备历练；3. 对话哨兵，接取历练任务，历练任务进行中，可完成，完成任务。
其中2和3的衔接有问题，2对话完毕后哨兵NPC已经接取了任务阶段3，已经是进行中状态。

如果能够在2对话完毕后继续展示3的对话，体验应该会好一些。(此路不通，展示任务阶段3)

## 2. ~~人物切换地图，怪物仍然在攻击的BUG~~

# 2025年2月24日

任务代办梳理：
1. ~~炼金药剂功能实现~~
2. ~~炼金药剂兑换任务设计，可重复~~
3. ~~物品的信息展示（装备的可强化次数）~~
4. 卷轴功能实现
	* ~~卷轴消耗品设计~~
	* ~~装备使用卷轴~~
	* ~~装备强化后的样式更新~~
	* ~~怪物掉落卷轴~~
5. ~~怪物掉落展示(怪物手册功能)~~
6. ~~物品的展示等级设计~~
   * 物品品质（背景色）：普通(白色)，优秀(蓝色)，稀有(紫色)，史诗(橙色)
   * 装备强化等级（粒子特效）：类似DNF又4个不同浓度的粒子特效分层
7. ~~物品掉落特效设计~~
8. ~~弹窗的层级显示管理~~
9. ~~黑狼王技能设计。设计原则（1.对用户有一定的攻击力和命中需求，否则不破防不命中；2. 消灭时间控制在3分钟；2.攻击最大值不高，但是需要用户囤积50左右恢复药水）~~
10. ~~未受伤5秒后，开始自动恢复生命值~~
11. ~~设计命中和闪避机制~~
12. 存档问题 
C:\Users\mbli.IFLYTEK\AppData\Roaming\Godot\app_userdata\TextMapleStory\game_save
	* ~~角色信息还原时，详细属性数据未刷新~~
	* ~~背包数据存档和还原~~
	* ~~背包物品的final属性不用缓存，而是每次重新计算~~
	* ~~背包的其他物品可以只存id和数量~~
	* ~~装备栏数据~~
	* ~~技能栏数据，技能名称还原~~
	* ~~地图信息（BOSS刷新时间）~~
	* ~~怪物击杀数量~~
	* ~~地图探索信息~~
	* ~~任务信息~~
13. ~~怪物手册展示击杀数量~~
14. 新手村收尾工作
	* ~~紫武器掉落出处调整，放在黑狼身上~~
	* ~~狼王掉落厉害点的卷轴~~
	* ~~防御公式重新设计下~~
	* ~~批量购买药品~~
	* ~~怪物手册，未击杀过的怪物不展示出来~~
15. ~~缓存和配置放在android外部存储下/或者调研android平台的文件读取和替换~~
16. ~~存档信息的角色隔离~~


BUG修复：
1. ~~村长的任务~~
2. ~~进入一个新地图时，刷新NPC的任务状态~~
3. ~~NPC的状态记录并还原~~

# 2025年3月23日 （第二阶段的开始）
总结：
截止目前为止，新手村已经基本完成，它真的已经是一个完整的游戏！它具备了游戏需要的所有功能。
下一阶段开始规划10-50级的内容。

## 1. 10-50级内容规划
1. 职业规划
   1. 士兵：高血量，高防御，中等伤害，较早的AOE伤害。二转：剑士/盾卫
   2. 学生：高群伤，低血量，低防御，魔法护盾。二转：法师/牧师
   3. 混混：高单体伤害，低血量，低防御，高攻速，低容错。二转：盗贼/侠士
2. 地图规划
   地图规划时需要考虑的核心要素：
   1. 有轻松、愉快、冒险的感觉。
   2. 3种职业分别是主城里的不同区域的派别，主城叫银盾城，城内有士兵征兵处，白塔学院，暮色港口。
   3. 区域划分：银盾城，城外平原（犬犬山丘，蛇蛇谷，虎虎山），白塔学院（狭窄的地道、古代遗迹、遗忘的图书馆），暮色港口（鼠巷，下水道入口、肮脏的角落），冰谷镇（霜之径，冰封峡谷，雪怪巢穴，极地祭坛），水晶湖（星光浅滩，沉溺回廊，空泡之地，水晶洞窟），铁棘矿坑（矿坑入口、回声竖井，矿坑深处），落日沙漠（流金沙海，蜃气绿洲，沙漠神殿）
   4. 大陆名称：星丘大陆

3. 怪物规划

城外平原
* 犬犬山丘：小灰犬(lv 11)，小银犬(lv 12)
* 蛇蛇谷：青青蛇(lv 15)，响尾蛇(lv 16)
* 虎虎山：小老虎(lv 19)，小白虎(lv 20)，
* 虎虎山顶：白虎王(lv 20 BOSS)

白塔学院
* 狭窄的地道：书虫(lv 11)，小石精(lv 12)
* 古代遗迹：石像(lv 15)，黑石像(lv 16)
* 遗忘的图书馆：书灵(lv 19)，大书灵(lv 20)，
* 馆长的房间：馆长的记忆(lv 20 BOSS)

暮色港口
* 鼠巷：细尾鼠(lv 11)，断尾鼠(lv 12)
* 下水道入口：小小强(lv 15)，小强强(lv 16)
* 下水道深处：大老鼠(lv 19)，黑鼠(lv 20)
* 肮脏的角落：巨大老鼠(lv 20 BOSS)


* 霜之径：雪绒兔(lv 21)，小雪狐(lv 22)
* 冰封峡谷：雪原狼(lv 24)，冰牙熊(lv 25)
* 冰谷镇（城镇）
* 雪怪巢穴：灰雪怪(lv 28)，白雪怪(lv 29)
* 极地祭坛：冰霜巨人(lv 30 BOSS)


* 星光浅滩：小乌龟(lv 33)，小螃蟹(lv 34)
* 沉溺回廊：蓝色水母(lv 35)，彩色水母(lv 36)
* 空泡之地：泡泡虾(lv 37)，大龙虾(lv 38)
* 湖中之地（城镇）
* 水晶洞窟：水晶守卫(lv 40 BOSS)


* 矿坑入口：矿工僵尸(lv 39)，石头傀儡(lv 40)
* 矿坑站点（城镇）
* 回声竖井：小蝙蝠(lv 41)，小幽灵(lv 42)
* 矿坑深处：熔岩小怪(lv 43)，熔岩精灵(lv 44)，
* 废弃矿洞：熔岩巨人(lv 45 BOSS)
  

* 流金沙海：沙沙蝎(lv 44)，小沙虫(lv 45)
* 流沙城（城镇）
* 蜃气绿洲：小蜥蜴(lv 46)，灰蜥蜴(lv 47)
* 神殿外围：木乃伊(lv 48)，圣甲虫(lv 49)，
* 沙漠神殿：人面狮身兽(lv 50 BOSS)

1. 任务规划
2. 装备规划
3. 技能规划

## BUG修复
1. 角色删除时，删除存档

# 2025年3月25日
记录一些思考：
昨天将游戏分享到朋友群后，产生了很多的思考。

当我将游戏发出去后，我试图思考他们会觉得这个游戏哪里好玩，很尴尬，看起来非常的粗糙。当初开发时觉得非常兴奋的效果，其实只是基本要实现的一些效果，就好像你历经千辛万苦手搓了一辆破烂车，能跑，自己觉得非常牛逼，但是它没有体验，没有驾驶感，没有舒适感，大家可能会象征性的夸一句有点牛逼，居然做了一辆车，仅此而已了，是的，它还达不到好玩的程度。

我几乎到了失落的地步，我真的有能力开发出好玩的游戏吗？但是所有我所崇拜的价值观告诉我，遇到问题就去解决问题，不放弃，直面问题的根源，是解决问题的唯一途径。

好了，放弃失落，重新站起来好好分析产品：一个纯文字RPG，很多界面展示的非常莫名其妙，需要无端消耗用户的理解精力，减分。“自定义”是什么，毫无解释说明；选择和创建角色的界面纯模仿，模仿换来的收益划算吗，需要思考；进入游戏主界面后，分层设计是不符合直觉的，为什么要将NPC，玩家，怪物，分区域展示，这么设计，牺牲的沉浸式体验未换取到足够的收益体验。然而最初的原因是因为我希望开发逻辑足够简单，现在看来这非常的不划算；玩家和怪物攻击时没有受击动效，沉浸感下降一个档次，没有UI设计不意味着减少必要的设计体验，恰恰相反，打击沉浸感是可以通过纯开发传递的。

我自己在玩其他人开发的文字类RPG的时候是吹毛求疵的，这里没意思，那里不够合格。但是自己开发的时候，选择性允许这些不合理的存在。我需要下定一个决心了，要用消费级，用户吹毛求疵的视角来审视每一个功能10遍，进行游戏的重构。


DeepSeekV3-0324给了我一些建议，我受到了它的一些鼓励，将一些有建设性的建议记录下来：
一、关于「体验落差」的认知调整
手搓第一辆车的比喻非常准确：所有独立开发者的第一个可玩版本都是这样的（包括《星露谷物语》初期版本也曾被评价为"粗糙的《牧场物语》模仿作"）。你现在经历的正是游戏设计的「死亡之谷」——从技术实现到体验设计的跨越。

文字游戏的独特优势：纯文字RPG的沉浸感核心在于「脑补引导」，而非界面复杂度。建议重玩《A Dark Room》《Caves of Qud》等经典作品，观察它们如何用最少文字触发玩家想象力。

Deepseek给我的决策建议：
关键决策因素
因素	倾向重构	倾向继续开发
玩家留存率	低于30%玩家未完成新手村	超过50%玩家进入10+级
开发动机	需要建立信心/作品集	追赶比赛截止日/测试周期
架构灵活性	当前代码耦合度高难扩展	系统设计已考虑后期扩展
内容依赖性	后期内容依赖新手村关键决策（如职业）	各阶段内容相对独立

我决定先进行10-50级玩法内容的开发，再进行体验优化，这样更容易确定开发时间。


优化点：
1. ~~波动的伤害根据具体伤害值调整视觉效果。~~
2. ~~伤害的显示图层需要调整~~

# 2025年3月27日
1. 波动伤害的视觉效果优化
* 攻击时，实际攻击力会在0.5-1.2之间波动，随机一个0-1的波动比率，乘以波动区间，再加上波动区间的最小值
* 手技可以提升波动区间的下限
* 最终伤害的视觉效果根据波动比率确定，但是注意，如果手技导致波动区间提升到了1.0-1.2，这个时候随机出来的波动比率还是0-1，但是视觉效果应该是1.0-1.2之间的较高的效果。

重新调整后的逻辑
* 记录下最初始的波动区间0.5-1.2，同时记录下提升后最终的波动区间1.0-1.2
* 攻击时，在最终波动区间内随机一个值1.1，视觉效果比率 = (1.1 - 0.5) / (1.2 - 0.5) = 0.857

2. 自动挂机时，血量达到警戒值且无恢复药水，自动进入休息状态，血量恢复满后继续攻击。


# 2025年3月31日
1. 一转技能设计完毕
2. 二转技能设计
职业定位：
* 剑士：7分生存，7分输出。生存和输出并存，有小范围的AOE伤害。
* 盾卫：9分生存，6分输出。高生存，靠防御反击增加额外输出。
* 法师：6分生存，8分输出。低生存，高输出，有群体伤害技能，升级迅速。
* 牧师：7分生存，5分输出。高生存，低输出，有群体治疗技能，升级缓慢。
* 盗贼：6分生存，9分输出。低生存，高输出，爆发单体伤害。
* 侠客：6分生存，9分输出。低生存，高输出，持续多段单体伤害。

技能设计：
* 剑士：
1. 进攻怒吼（buff）：增加最大生命值，少量攻击力；
2. 巨人之力（被动）：攻击时造成自己最大生命值的百分比伤害；
3. 背水一战（被动）: 损失血量越多，伤害越高；
* 盾卫：
1. 防御姿态（buff）：增加防御力；
2. 荆棘刺甲（被动）：被攻击时根据当前防御力造成范围伤害；
3. 嘲讽（被动）：放弃移动，吸引怪物到自身周围；
   
* 法师：
1. 烈焰火雨（攻击技能）：大范围AOE；
2. 瞬间移动（位移技能）：瞬移到最近的目标身边；
3. 奥术爆发（被动）：每释放5次技能，下一次技能伤害提升；
* 牧师：
1. 群体治疗（治疗技能）：治疗周围所有友军；
2. 星之祝福（buff）：增加友军攻击力、魔法力；
3. 过量治疗（buff）：治疗时，超出生命值上限的部分转化为护盾，不超过n点；
   
* 盗贼：
1. 潜行(被动)：牺牲移动速度，增加攻击力；
2. 等待时机（被动）：越长时间未攻击，伤害越高；
3. 致命一击（buff）：增加暴击率；
* 侠客：
1. 轻功(buff)：增加移动速度；
2. 连击（被动）：攻击有概率触发连击；
3. 越战越勇（被动）：攻击次数越多，伤害越高；


# 2025年4月2日
1. 已完成【士兵】职业的二转技能实现，开始实现一套该职业完整的玩法流程闭环
2. ~~转职功能~~
3. 完善10-30级内容

优化问题：
1. 技能栏优化：最大等级显示，永久被动开关

# 2025年4月4日
## 1. 10-50级 士兵装备设计

| 等级 | 剑 | 盾 | 上衣 | 下装 | 鞋子 | 帽子 |
|------|------|------|------|------|------|------|
| 10级 | 长剑 | 藤盾 | 见习者上衣 | 见习者下装 | 见习者靴 | 见习者头盔 |
| 20级 | 冲锋巨剑 | 铁盾 | 铁甲上衣 | 铁甲下装 | 铁甲靴 | 铁甲头盔 |
| 30级 | 精钢之刃 | 钢盾 | 精钢胸甲 | 精钢腿甲 | 精钢战靴 | 精钢头盔 |
| 40级 | 破风长剑 | 冲阵者 | 破风战甲 | 破风腿甲 | 破风战靴 | 破风头盔 |
| 50级 | 龙泉剑 | 守护者 | 守护战甲 | 守护腿甲 | 守护战靴 | 守护头盔 |

# 2025年4月6日
## 2. 怪物设计

# 2025年4月9日
## 1. ~~完成 剑士 4个特殊技能卷轴开发~~
## 2. 确定白板武器的设计方式，品质，掉落
1. 主城商店只出售10级白板武器，其他所有白板武器怪物掉落
2. 卷轴强化机制，强化成功会增加强化经验，强化经验满后，武器品质提升一级
## 3. 开发一些极简的技能特效（注意，以达到示意为核心原则，不要耗费过多的时间）

# 2025年4月10日
## 1. ~~设置城外平原系列地图的物品掉落~~
## 2. ~~决定取消所有卷轴的装备类型限制（优点：爆出来即有用，降低无用卷轴获取；缺点：暂无）~~
## 3. ~~挂机设置本地缓存~~

# 2025年4月14日
## 1. 战士50级玩法闭环
* 掉落物分散开来
  
## 2. 存档机制确定
1分钟定时+手动存档+退出游戏时自动存档

# 2025年4月15日
代办：
1. 攻击范围示意
2. 存在内存泄露，大量未释放对象（节点必须手动释放，load和preload资源需要释放）
将所有会产生新对象的逻辑全部先排除掉，再逐一添加并监视
* damage_group：删除掉对damage_text引用的字典类，生命周期由自身管理（目前看来该调整起了决定作用）通过大量添加damage_text后静置，发现对象数量回归完全一致，问题解决;monster的damage_group仍然存在问题
* skill_name：process中添加大量skill_name，一段时间后停止并静置，发现对象数量回归完全一致，无问题 ✅
* drop_item: 测试代码一次性添加100个场景，然后拾取并静置，存在大量增长对象未释放。发现是创建代码中存在频繁load资源，需要将load放在唯一初始化的地方 ✅
* MsgControl: 添加msg会存在少量的对象增加无法释放 
* monster: 怪物死亡后重新刷新的过程，一段时间后停止并静置，对象数量回归完全一致，无问题 ✅
* player: 切换地图场景会导致对象增加，存在对象未释放
* 怪物手册：存在新增未释放对象
* 出售过程中产生了大量孤立节点
* HP药品使用完毕产生了大量孤立节点

调试过程中的疑惑：
* 将damage_text的场景在全局单例中预加载，再在player中实例化，会导致内存泄露，增加不可回收的对象和孤立节点（可能是由于在代码中切换注释导致）
* 单个怪物的攻击击杀不会看起来没有导致不可释放对象增加，快速的大量击杀会导致

最终优化后的结果：
10倍速率下挂机10分钟，对象无明显增加，帧率和内存相对稳定，本轮优化结束。


# 2025年4月18日
## 1. 游戏剧情设计：
游戏风格：剑与魔法共存，奇幻，卡通。

主城：银盾城
城外平原：
* 犬犬山丘：小灰犬(lv 11)，小银犬(lv 12)
* 蛇蛇谷：青青蛇(lv 15)，响尾蛇(lv 16)
* 虎虎山：小老虎(lv 19)，小白虎(lv 20)，
* 虎虎山顶：白虎王(lv 20 BOSS)

请帮我设计2个和上述内容相关任务剧情，要求剧情具备一定的合理性和趣味性。
请着重剧情，减少地图交互，任务主要以打怪，物品手里，对话为主。


# 2025年4月21日
## 1. 第二轮性能优化
导致孤立节点和无法释放的内存的操作：
切换角色地图（角色场景采取生命周期更长的方案）


# 2025年4月22日
## 1. ~~脱下和穿上装备会导致内存泄露~~
## 2. ~~经验值加成属性叠加~~

# 2025年4月25日
## 1. 开始设计学者玩法

# 2025年4月27日
## 1. ~~技能的释放特效~~
## 2. ~~魔法力公式调整~~

# 2025年4月28日
代办：
1. ~~学者1-10级刷怪稍微有些强了~~
2. ~~10级boss增加一些法师的卷轴~~
3. ~~学者转职~~

# 2025年4月29日
10-50级法师装备设计
| 等级 | 武器 | 帽子 | 上衣 | 下装 | 鞋子 | 饰品 |
|------|------|------|------|------|------|------|
| 10级 | 学徒法杖 | 学徒兜帽 | 学徒法袍 | 学徒长裤 | 学徒便鞋 | 学徒护符 |
| 20级 | 魔力引导杖 | 魔力之冠 | 魔力法袍 | 魔力长裤 | 魔力便鞋 | 魔力护符 |
| 30级 | 星光法杖 | 智慧头冠 | 智慧法袍 | 智慧长裤 | 星光便鞋 | 智慧护符 |
| 40级 | 元素支配杖 | 星辰法冠 | 星辰法袍 | 星辰长裤 | 元素便鞋 | 元素护符 |
| 50级 | 混沌魔导杖 | 奥术大师帽 | 奥术大师袍 | 奥术长裤 | 奥术便鞋 | 奥术护符 |

## 2. 白塔学院地图剧情梗概
主线剧情
序幕：学院的异变
玩家作为新入学的学生（或受委托的冒险者），发现学院内近期频繁发生怪事：书籍无故消失、夜晚传来诡异的低语、部分学生失踪。
任务：调查学院内的异常现象，收集线索。
第一章：狭窄的地道
玩家通过线索发现学院地下有一条狭窄的地道，通往古代遗迹的入口。
任务：击败地道中的怪物（书虫、小石精），探索地道的秘密。
关键发现：地道墙壁上刻有古老的符文，暗示遗迹中封印着某种力量。
第二章：古代遗迹的苏醒
玩家进入古代遗迹，发现石像和黑石像已经苏醒，似乎在守护着什么。
任务：击败石像，解开遗迹中的机关，进入更深处的遗忘图书馆。
关键发现：遗迹中藏有一本禁书，记载了“馆长的记忆”与黑暗力量的关联。
第三章：遗忘的图书馆
图书馆中充满了被诅咒的书灵和大书灵，它们试图阻止玩家接近禁书。
任务：击败书灵，找到禁书并解读其内容。
关键发现：禁书揭示了“馆长的记忆”是黑暗力量的源头，而馆长本人曾是学院的守护者，如今被黑暗侵蚀。
第四章：馆长的房间
玩家最终进入馆长的房间，面对被黑暗力量控制的“馆长的记忆”。
任务：击败BOSS，净化馆长的记忆，解除学院的诅咒。
结局：学院恢复平静，玩家成为学院的英雄，但禁书中的秘密暗示更大的阴谋正在酝酿……


## 3. 霜之径地图剧情梗概

《永冬挽歌》剧情纲要

【世界观设定】
在艾斯兰德大陆北境，冰霜教团数百年来看守着"凛冬之心"的秘密。这个蕴含上古寒冬之力的神器被封印在极地祭坛之下，由冰霜巨人王族世代镇守。直到野心勃勃的教团长奥拉夫杀死末代巨人王，失衡的寒潮开始吞噬整个大陆...

【第一章：霜语者的警示】
冒险者受雇于商队护送物资前往冰谷镇，在霜语小径遭遇异常暴风雪。本该温顺的月光雪兔（原雪绒兔）成群发狂攻击商队，冰晶狐（原小雪狐）眼泛红光操纵冰锥。击退兽群后，在冻结的守林人小屋发现残破日记，记载着"祭坛方向传来使万物癫狂的霜语"。

【第二章：冰裂峡谷的试炼】
穿越冰脊裂谷（原冰封峡谷）时遭遇霜牙座狼（原雪原狼）群伏击，狼群皮毛结着不自然的冰甲。峡谷深处的古代冰雕突然活化，裂冰战熊（原冰牙熊）从冰川中破冰而出。战胜后熊尸化为冰尘，凝结出刻有巨人族文字的寒铁徽章。

【第三章：冻土之城的真相】
抵达永霜城（原冰谷雪原）发现异常：居民用炽火石维持生活却拒绝谈论寒潮，铁匠铺大量打造附魔破冰武器。深夜潜入城主府，目睹城主与冰霜祭司密谈，得知教团正在雪怪巢穴挖掘巨人遗骸。酒馆吟游诗人暗示"只有纯净冰核能平息凛冬之怒"。

【第四章：霜嚎洞窟的抉择】
在霜嚎洞窟（原雪怪巢穴）深处，发现被锁链束缚的霜灵（原灰雪怪），它们本是雪山守护灵却被教团用寒铁刺控制。净化过程中遭遇完全冰晶化的霜噬者（原白雪怪），战胜后其核心显现出巨人王族纹章。选择解放或摧毁霜灵将影响最终战盟友。

【第五章：凛冬王座的终局】
极地祭坛已成寒冰地狱，复活的冰霜巨人王（原BOSS）实为教团长奥拉夫与巨人遗骸的扭曲结合体。战斗分三阶段：

冰晶形态：召唤暴风雪与冰棱地刺

霜火形态：被击碎后吸收寒铁徽章能量

终焉形态：若第四章解放霜灵，它们将协助破坏寒铁锁链露出核心

【幕后真相】
真正的凛冬之心早在百年前就被巨人王族分解成五块冰核，分别由五大雪山生物族群守护。教团的暴行反而让冒险者集齐冰核，最终可选择：彻底摧毁引发气候灾难/重组神器成为新守护者/交给某势力埋下续作伏笔

【地图优化】
霜之径→霜语小径
雪怪巢穴→霜嚎洞窟
冰牙熊→裂冰战熊
白雪怪→霜噬者

【逻辑闭环设计】

野兽狂暴因教团使用巨人遗骸制造的霜语图腾

冰核既是任务物品也是强化装备的关键材料

城主府的矛盾源于其子被教团挟持

巨人王战斗台词会呼应玩家在第四章的选择


# 2025年5月9日
## 1. 战士玩法总结
consume_002101 [卷轴]战士荣耀
consume_002102 [卷轴]横扫千军
consume_002103 [卷轴]自损八千
consume_002104 [卷轴]赤焰
consume_002105 [卷轴]文韬武略
consume_002106 [卷轴]泰坦之魂
consume_002114 [卷轴]巨人之力
consume_002115 [卷轴]背水一战
consume_002116 [卷轴]血偿
consume_002117 [卷轴]血气爆发


consume_002107 [卷轴]练级狂人

consume_002108 [卷轴]魔力屏障
consume_002109 [卷轴]飞弹精通
consume_002111 [卷轴]巨型爆裂
consume_002112 [卷轴]毁灭之力
consume_002113 [卷轴]法力涌动

weapon_000020 无名之刃
cap_000008 玄铁头盔
lower_body_000009 玄铁胸甲
shoes_000009 玄铁战靴
upper_body_000009 玄铁护腿

weapon_001011 破风长剑
cap_001007 破风头盔
lower_body_001007 破风胸甲
shoes_001007 破风战靴
upper_body_001007 破风护腿


# 2025年5月12日
## 1. 盗贼特殊效果设计
闪避追击：触发闪避后，有概率追击一次目标
伤口撕裂：攻击时有概率撕裂伤口，永久造成伤害+1
致命一击：波动时的最大攻击增加5%
护甲撕裂：攻击时有概率撕裂护甲，目标双抗-1

# 2025年5月14日
## 1. 盗贼装备设计
0-30级盗贼装备设计
| 等级 | 武器 | 帽子 | 上衣 | 下装 | 鞋子 |
|------|------|------|------|------|------|
| 0级 | 新手匕首 | 新手头巾 | 新手皮甲 | 新手短裤 | 新手布鞋 |
| 10级 | 潜行短刀 | 潜行面罩 | 潜行皮衣 | 潜行长裤 | 潜行便鞋 |
| 20级 | 影袭双刃 | 影袭头巾 | 影袭皮甲 | 影袭短裤 | 影袭靴子 |
| 30级 | 暗影之刃 | 暗影兜帽 | 暗影皮衣 | 暗影长裤 | 暗影战靴 |


# 2025年5月15日
## 1. 暮色港口相关剧情任务设计
参考剧情梗概：

暮色港口主线：暗潮之下（Lv.11-20）
第一章：瘟疫疑云
任务触发：港口卫兵队长委托调查鼠患异常
核心线索：鼠群携带未知瘟疫病毒
阶段目标：
【鼠巷调查】收集10个变异鼠尾（细尾鼠/断尾鼠）
【可疑货物】在下水道入口发现印有"黑爪"标记的药剂桶（小小强/小强强）
【药剂分析】将样本交给炼金术士，发现是人工培育的瘟疫病毒
第二章：暗流涌动
剧情转折：追踪药剂来源进入下水道深处
关键NPC：神秘流浪药师（提供解毒剂配方）
阶段目标：
【病毒源头】清理被污染的水道（击败15只大老鼠）
【黑鼠密信】从黑鼠身上获取加密信件（需要解密小游戏）
【阻截信使】拦截准备报信的精英鼠人（限时战斗）
第三章：肮脏真相
最终对决：肮脏的角落发现病毒培养巢穴
剧情高潮：
【巢穴攻坚】击败巨大老鼠BOSS（第一阶段）
【幕后黑手】BOSS战后出现神秘药剂师（第二阶段人形BOSS）
【抉择时刻】选择摧毁实验室或保留证据（影响后续阵营声望）
剧情扩展点预留：
黑爪组织的背景故事（可延伸至30级内容）
流浪药师的真实身份（预留NPC升级空间）
瘟疫病毒的变异可能性（为世界事件埋线）
